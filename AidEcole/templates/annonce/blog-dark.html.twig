{% extends 'home/home.html.twig' %}

{%  block body   %}

<div class="blogarea__2 sp_top_100 sp_bottom_100">
    <div class="container">
        <div class="row">
            <div class="col-xl-8 col-lg-8 col-md-12 col-sm-12 col-12">


                    {% for annonce in annonces %}

            


                <div class="blog__content__wraper__2" data-aos="fade-up">
                    <div class="blogarae__img__2">
                                        {% if annonce.image %}
                                            <img loading="lazy" src="{{ asset('imagesAnnonces/' ~ annonce.image) }}" alt="blog" style="width: 200px; height: auto;">
                                        {% else %}
                                            Pas d'image
                                        {% endif %}
                        <div class="blogarea__date__2">
                            <span>24</span>
                            <span class="blogarea__month">Feb</span>
                        </div>
                    </div>
                    <div class="blogarea__text__wraper__2">
                        <div class="blogarea__heading__2">
                            <h3><a href="blog-details.html">{{annonce.titre}}</a></h3>
                        </div>
                        <div class="blogarea__list__2">
                            
                        </div>
                        <div class="blogarea__paragraph">
                            <p>{{annonce.description}}</p>
                        </div>
                        <div class="blogarea__button__2">
                        


<div class="blogarea__button__2 d-flex justify-content-center align-items-center gap-3">
    <!-- Bouton Lire encore -->
    <a href="{{ path('app_annonce_show', {'id': annonce.id}) }}" class="btn btn-info">Lire encore</a>

    {% if app.user %}
    {% if annonce.isParticipant(app.user) %}
        <p>You are already participating in this annonce.</p>
    {% elseif annonce.participants.count() < annonce.NbrePlace %}
        <form action="{{ path('annonce_participate', {'id': annonce.id}) }}" method="POST">
            <button type="submit" class="btn btn-primary">Participate</button>
        </form>
    {% else %}
        <p>No available places left.</p>
    {% endif %}
{% else %}
    <p><a href="{{ path('app_login') }}">Log in</a> to participate.</p>
{% endif %}
</div>
    
</div>


                </div>
            
<!-- Comments Section -->
<div style="padding: 1rem; background-color: #fff; border-top: 1px solid #ddd;">
    <h4 style="margin: 0 0 1rem 0;">Commentaires ({{ annonce.commentaires|length }})</h4>
    <ul style="list-style: none; padding: 0; margin: 0;">
        {% for commentaire in annonce.commentaires %}
    <li style="border-bottom: 1px solid #eee; padding: 1rem 0; display: block;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <span style="font-weight: bold; color: #555;">{{ commentaire.user.prenom }}</span>
            <span style="color: #999; font-size: 12px;">{{ commentaire.date|date('d M Y') }}</span>
        </div>
        <p style="margin: 0; color: #555; line-height: 1.5;">
            {{ commentaire.Description }}
        </p>
        {% if user.id == commentaire.user.id %}
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <!-- Delete Button -->
            <form method="POST" action="{{ path('app_commentaire_delete', {'id': commentaire.id}) }}" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                <input type="hidden" name="_method" value="DELETE">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ commentaire.id) }}">
                <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Delete</button>
            </form>
            <!-- Update Button -->
            <a href="{{ path('app_commentaire_update', {'id': commentaire.id}) }}" style="background-color: #28a745; color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                Update
            </a>
        </div>
        {% endif %}
    </li>
{% else %}
    <li style="color: #999; text-align: center; padding: 1rem;">Aucun commentaire pour cette annonce.</li>
{% endfor %}
    </ul>
</div>

<!-- Comment Form -->
<div style="padding: 1rem; background-color: #f9f9f9; border-top: 1px solid #ddd;">
    <h4 style="margin: 0 0 1rem 0;">Ajouter un commentaire</h4>
    <form method="POST" action="{{ path('app_annonceparent_index_1') }}" style="display: flex; flex-direction: column; gap: 1rem;" novalidate>
        {{ form_start(forms[annonce.id]) }}
        
        {# Champ Description #}
        <div>
            {{ form_label(forms[annonce.id].Description, 'Description', {'label_attr': {'style': 'font-weight: bold; margin-bottom: 0.5rem;'}}) }}
            {{ form_widget(forms[annonce.id].Description, {'attr': {'style': 'width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;'}}) }}
            {{ form_errors(forms[annonce.id].Description, {'attr': {'class': 'form-error', 'style': 'color: red; font-size: 0.875rem; margin-top: 0.5rem;'}}) }}
        </div>

        {# Champ cach√© pour l'ID de l'annonce #}
        <input type="hidden" name="annonce_id" value="{{ annonce.id }}" />

        {# Bouton de soumission #}
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <button type="submit" style="background-color: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Poster un commentaire</button>
        </div>

        {{ form_end(forms[annonce.id]) }}
    </form>
</div>
    </div>
{% endfor %}




                <div class="main__pagination__wrapper" data-aos="fade-up">
                    <ul class="main__page__pagination">
                        <li><a class="disable" href="#"><i class="icofont-double-left"></i></a></li>
                        <li><a class="active" href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#"><i class="icofont-double-right"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12">
                <div class="blogsidebar__content__wraper__2" data-aos="fade-up">
                    <div class="blogsidebar__content__inner__2">
                        <div class="blogsidebar__img__2">
                            <img loading="lazy"  src="img/blog/blog_10.png" alt="blog">
                        </div>
                        <div class="blogsidebar__name__2">
                           
                           


                    </form>

                </div>
                
               

                       
                       
                    </ul>



               

                </div>
            </div>
        </div>
    </div>
</div>

<style>
.annonce-image {
    width: 200px; /* Adjust as needed */
    height: auto; /* Maintain aspect ratio */
}
</style>

{% endblock %}